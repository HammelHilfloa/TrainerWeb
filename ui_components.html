<div id="uiModalHost"></div>

<template id="tpl-modal">
  <div class="modal-backdrop" data-modal-backdrop>
    <div class="modal" role="dialog" aria-modal="true">
      <div class="modal-header">
        <h3 class="modal-title"></h3>
        <button class="icon-btn" type="button" data-modal-close aria-label="SchlieÃŸen">&times;</button>
      </div>
      <div class="modal-body"></div>
      <div class="modal-footer"></div>
    </div>
  </div>
</template>

<script>
  const UIComponents = (() => {
    const host = () => document.querySelector('#uiModalHost');
    const modalTemplate = () => document.querySelector('#tpl-modal');

    function badge(text, variant = 'neutral') {
      const safeText = text || '';
      return `<span class="badge ${variant}">${safeText}</span>`;
    }

    function emphasis(text) {
      return `<strong>${text || ''}</strong>`;
    }

    function ensureHost() {
      const h = host();
      if (!h) {
        const div = document.createElement('div');
        div.id = 'uiModalHost';
        document.body.appendChild(div);
      }
    }

    function closeOpenModals() {
      document.querySelectorAll('[data-modal-backdrop]').forEach((m) => m.remove());
    }

    function createModal({ title = '', body = '', actions = [] } = {}) {
      ensureHost();
      closeOpenModals();
      const tpl = modalTemplate();
      if (!tpl) return null;
      const clone = tpl.content.cloneNode(true);
      const modalEl = clone.querySelector('[data-modal-backdrop]');
      const bodyEl = clone.querySelector('.modal-body');
      const titleEl = clone.querySelector('.modal-title');
      const footerEl = clone.querySelector('.modal-footer');

      if (titleEl) titleEl.innerHTML = title;
      if (bodyEl) bodyEl.innerHTML = body;
      if (footerEl) {
        footerEl.innerHTML = '';
        actions.forEach((action) => {
          const btn = document.createElement('button');
          btn.type = 'button';
          btn.className = `btn ${action.variant || 'ghost'}`;
          btn.textContent = action.label || '';
          if (action.onClick) btn.addEventListener('click', action.onClick);
          if (action.id) btn.id = action.id;
          footerEl.appendChild(btn);
        });
      }

      const backdropClose = () => modalEl.remove();
      clone.querySelector('[data-modal-close]')?.addEventListener('click', backdropClose);
      modalEl.addEventListener('click', (ev) => {
        if (ev.target === modalEl) backdropClose();
      });

      host().appendChild(clone);
      return document.querySelector('[data-modal-backdrop]');
    }

    function setModalBody(content) {
      const modal = document.querySelector('[data-modal-backdrop]');
      if (!modal) return;
      const bodyEl = modal.querySelector('.modal-body');
      if (bodyEl) bodyEl.innerHTML = content;
    }

    return {
      badge,
      emphasis,
      createModal,
      setModalBody,
      closeOpenModals,
    };
  })();
</script>
